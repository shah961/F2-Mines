<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log In | FÂ² Mines</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0b0612; --nav-bg: rgba(11, 6, 18, 0.9); --text: #ffffff;
            --muted: #b3a9c9; --purple: #7c3aed; --purple-glow: #a855f7;
            --accent: #f59e0b; --border: rgba(124, 58, 237, 0.3);
            --card-bg: rgba(20, 11, 31, 0.6); --input-bg: rgba(255, 255, 255, 0.05);
        }

        body.light-mode {
            --bg: white; --nav-bg: rgba(255, 255, 255, 0.95); --text: #0f172a;
            --muted: #475569; --purple: #6d28d9; --purple-glow: #8b5cf6;
            --border: #e2e8f0; --card-bg: rgba(255, 255, 255, 0.8); --input-bg: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; transition: 0.3s ease; overflow-x: hidden; }

        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; background: var(--nav-bg); backdrop-filter: blur(10px); position: sticky; top: 0; width: 100%; z-index: 1000; border-bottom: 1px solid var(--border); }
        .logo { display: flex; align-items: center; gap: 10px; font-weight: 900; font-size: 22px; text-decoration: none; color: inherit; }
        .logo span { background: var(--accent); width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; border-radius: 50%; box-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }
        .logo-b { color: #000; font-weight: 900; font-size: 20px; transform: rotate(14deg); }
        .theme-btn { background: none; border: 1px solid var(--border); color: var(--text); cursor: pointer; padding: 8px; border-radius: 50%; font-size: 18px; outline: none; }

        .auth-wrapper { flex: 1; display: grid; grid-template-columns: 1fr 1.2fr; align-items: center; padding: 40px 5%; gap: 50px; }
        .auth-visual { position: relative; text-align: left; }
        .auth-visual h1 { font-size: clamp(32px, 5vw, 56px); font-weight: 900; line-height: 1.1; margin-bottom: 20px; }
        .auth-visual h1 span { color: var(--purple-glow); }

        .hero-coin { width: 220px; height: 220px; background: linear-gradient(135deg, #ffd700 0%, #f59e0b 50%, #b8860b 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; border: 6px solid #d4af37; box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(255,255,255,0.4); animation: float 4s ease-in-out infinite; margin-top: 30px; }
        .coin-b { font-size: 130px; font-weight: 900; color: #fff; transform: rotate(14deg); text-shadow: 2px 2px 0px rgba(0,0,0,0.2); }
        .hero-coin::before { content: ""; position: absolute; width: 180px; height: 180px; border-radius: 50%; border: 2px dashed rgba(255,255,255,0.3); }

        .auth-card { background: var(--card-bg); backdrop-filter: blur(25px); padding: 50px; border-radius: 30px; border: 1px solid var(--border); box-shadow: 0 20px 40px rgba(0,0,0,0.3); max-width: 480px; width: 100%; margin-right: auto; }
        .auth-card h2 { font-size: 32px; font-weight: 900; margin-bottom: 10px; }
        .subtitle { color: var(--muted); margin-bottom: 30px; font-size: 15px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        .form-group input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); outline: none; transition: 0.3s; }
        .form-group input:focus { border-color: var(--purple); box-shadow: 0 0 15px rgba(124, 58, 237, 0.2); }

        .login-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; background: linear-gradient(135deg, var(--purple), var(--purple-glow)); color: white; font-weight: 800; font-size: 16px; cursor: pointer; box-shadow: 0 10px 20px rgba(124, 58, 237, 0.3); transition: 0.3s; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(124, 58, 237, 0.5); }
        .login-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .footer-links { text-align: center; margin-top: 25px; color: var(--muted); font-size: 14px; }
        .footer-links a { color: var(--purple-glow); text-decoration: none; font-weight: 700; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        @media (max-width: 992px) {
            .auth-wrapper { grid-template-columns: 1fr; text-align: center; }
            .auth-visual { display: none; }
            .auth-card { margin: 0 auto; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="logo"><span><b class="logo-b">â‚¿</b></span> FÂ² MINES</a>
        <div class="nav-right">
            <button class="theme-btn" id="themeToggle">ðŸŒ™</button>
        </div>
    </nav>

    <main class="auth-wrapper">
        <section class="auth-visual">
            <h1>Welcome back to <br><span>Future Finance</span>.</h1>
            <p>Log in to manage your hashrate, track mining progress, and withdraw your daily rewards.</p>
            <div class="hero-coin">
                <span class="coin-b">â‚¿</span>
            </div>
        </section>

        <section class="auth-card">
            <h2>Log In</h2>
            <p class="subtitle">Enter your details to access your dashboard.</p>

            <form id="loginForm">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="email" placeholder="name@example.com" required>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>

                <div style="display: flex; justify-content: space-between; margin-bottom: 25px; font-size: 13px;">
                    <label style="color: var(--muted); cursor: pointer;">
                        <input type="checkbox" style="accent-color: var(--purple);"> Remember me
                    </label>
                    <a href="#" style="color: var(--purple-glow); text-decoration: none; font-weight: 600;">Forgot Password?</a>
                </div>

                <button type="submit" class="login-btn" id="loginBtn">Log In to Dashboard</button>
            </form>

            <p class="footer-links">Don't have an account? <a href="signup.html">Sign Up Free</a></p>
        </section>
    </main>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, setPersistence, browserLocalPersistence, browserSessionPersistence, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAiVujpar4bp-eCGZTEaCu6VKwhsJG7J3I",
        authDomain: "f2mines1.firebaseapp.com",
        databaseURL: "https://f2mines1-default-rtdb.firebaseio.com",
        projectId: "f2mines1",
        storageBucket: "f2mines1.firebasestorage.app",
        messagingSenderId: "546591819609",
        appId: "1:546591819609:web:97e8009b59fc3cdf44ee48",
        measurementId: "G-QNFE6KPNLE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    const loginForm = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    const savedTheme = localStorage.getItem('f2_theme') || 'dark';
    if (savedTheme === 'light') {
        body.classList.add('light-mode');
        themeToggle.innerHTML = 'â˜€ï¸';
    }

    themeToggle.addEventListener('click', () => {
        const isLight = body.classList.toggle('light-mode');
        localStorage.setItem('f2_theme', isLight ? 'light' : 'dark');
        themeToggle.innerHTML = isLight ? 'â˜€ï¸' : 'ðŸŒ™';
    });

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        const rememberMe = document.querySelector('input[type="checkbox"]')?.checked;

        if (!email || !password) {
            alert("Please fill in all fields.");
            return;
        }

        if (email === "muhammadanventures@gmail.com" && password === "admin123") {
            alert("Welcome Back, Admin!");
            window.location.href = 'admin.html';
            return;
        }

        loginBtn.disabled = true;
        loginBtn.innerHTML = 'Authenticating...';

        try {
            const mode = rememberMe ? browserLocalPersistence : browserSessionPersistence;
            await setPersistence(auth, mode);

            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            const userRef = ref(database, 'users/' + user.uid);
            const snapshot = await get(userRef);
            
            if (snapshot.exists()) {
                alert("Login Successful!");
                window.location.href = 'dashboard.html';
            } else {
                // RE-REGISTER LOGIC (Agar data delete ho chuka hai)
                let newName = prompt("Account status: Data cleared. Enter your Full Name to re-register:");
                if (newName && newName.trim() !== "") {
                    const myNewCode = "F2-" + Math.random().toString(36).substring(2, 7).toUpperCase();
                    await set(ref(database, 'users/' + user.uid), {
                        name: newName,
                        email: user.email,
                        uid: user.uid,
                        balance: 0,
                        hashrate: 0,
                        referralCode: myNewCode,
                        referredBy: "re-registered",
                        createdAt: new Date().toISOString(),
                        miningState: { active: false, totalSec: 0, sessionSec: 0, coin: 'BTC' }
                    });
                    alert("Re-registered successfully!");
                    window.location.href = 'dashboard.html';
                } else {
                    await signOut(auth);
                    alert("Registration required.");
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = 'Log In to Dashboard';
                }
            }
        } catch (error) {
            loginBtn.disabled = false;
            loginBtn.innerHTML = 'Log In to Dashboard';
            alert("Error: " + error.message);
        }
    });
</script>
</body>
</html>
